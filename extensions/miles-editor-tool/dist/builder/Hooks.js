"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.onAfterMake = exports.onBeforeMake = exports.onError = exports.onAfterBuild = exports.onAfterCompressSettings = exports.onBeforeCompressSettings = exports.onBeforeBuild = void 0;
const Config_1 = require("../tools/Config");
const Utils_1 = require("../tools/Utils");
const BuildLogger_1 = require("./BuildLogger");
const BuildConfig_1 = require("./postbuild/BuildConfig");
const BuildNative_1 = require("./postbuild/BuildNative");
const GameTool_1 = require("./postbuild/GameTool");
const HotUpdate_1 = require("./postbuild/HotUpdate");
const tag = "[Build]";
const onBeforeBuild = async function (options, result) {
    // Todo some thing
};
exports.onBeforeBuild = onBeforeBuild;
const onBeforeCompressSettings = async function (options, result) {
    // Todo some thing
};
exports.onBeforeCompressSettings = onBeforeCompressSettings;
const onAfterCompressSettings = async function (options, result) {
    // Todo some thing
};
exports.onAfterCompressSettings = onAfterCompressSettings;
const onAfterBuild = async function (options, result) {
    BuildLogger_1.BuildLogger.info(tag, "后处理开始");
    BuildConfig_1.BuildConfig.execute(options, result);
    if (Utils_1.Utils.isNative(options.platform)) {
        BuildNative_1.BuildNative.execute(options, result);
        /** 是否启用热更 */
        let hotupdateEnable = Config_1.Config.get("gameSetting.hotupdate", false);
        BuildLogger_1.BuildLogger.info(tag, 'hotupdateEnable', hotupdateEnable);
        if (hotupdateEnable) {
            HotUpdate_1.HotUpdate.modifyJsFile(options, result);
            HotUpdate_1.HotUpdate.replaceManifest(options, result);
        }
    }
    if (Utils_1.Utils.isMinigame(options.platform)) {
        if (!options.md5Cache) {
            BuildLogger_1.BuildLogger.error(tag, "小游戏请开启Md5Cache");
        }
        GameTool_1.GameTool.minigameDeleteManifest(options, result);
    }
    await GameTool_1.GameTool.modifyRemoteResServer(options, result);
    await GameTool_1.GameTool.uploadRemoteResToAliOss(options, result);
    BuildLogger_1.BuildLogger.info(tag, "后处理结束");
};
exports.onAfterBuild = onAfterBuild;
const onError = async function (options, result) {
    // Todo some thing
};
exports.onError = onError;
const onBeforeMake = async function (root, options) {
    // Todo some thing
};
exports.onBeforeMake = onBeforeMake;
const onAfterMake = async function (root, options) {
    // Todo some thing
};
exports.onAfterMake = onAfterMake;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSG9va3MuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zb3VyY2UvYnVpbGRlci9Ib29rcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFDQSw0Q0FBeUM7QUFDekMsMENBQXVDO0FBQ3ZDLCtDQUE0QztBQUM1Qyx5REFBc0Q7QUFDdEQseURBQXNEO0FBQ3RELG1EQUFnRDtBQUNoRCxxREFBa0Q7QUFFbEQsTUFBTSxHQUFHLEdBQUcsU0FBUyxDQUFDO0FBRWYsTUFBTSxhQUFhLEdBQTRCLEtBQUssV0FBVyxPQUF5QixFQUFFLE1BQW9CO0lBQ2pILGtCQUFrQjtBQUV0QixDQUFDLENBQUM7QUFIVyxRQUFBLGFBQWEsaUJBR3hCO0FBRUssTUFBTSx3QkFBd0IsR0FBdUMsS0FBSyxXQUFXLE9BQXlCLEVBQUUsTUFBb0I7SUFDdkksa0JBQWtCO0FBQ3RCLENBQUMsQ0FBQztBQUZXLFFBQUEsd0JBQXdCLDRCQUVuQztBQUVLLE1BQU0sdUJBQXVCLEdBQXNDLEtBQUssV0FBVyxPQUF5QixFQUFFLE1BQW9CO0lBQ3JJLGtCQUFrQjtBQUN0QixDQUFDLENBQUM7QUFGVyxRQUFBLHVCQUF1QiwyQkFFbEM7QUFFSyxNQUFNLFlBQVksR0FBMkIsS0FBSyxXQUFXLE9BQXlCLEVBQUUsTUFBb0I7SUFDL0cseUJBQVcsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQy9CLHlCQUFXLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxNQUFNLENBQUMsQ0FBQztJQUNyQyxJQUFJLGFBQUssQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxFQUFFO1FBQ2xDLHlCQUFXLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxNQUFNLENBQUMsQ0FBQztRQUNyQyxhQUFhO1FBQ2IsSUFBSSxlQUFlLEdBQUcsZUFBTSxDQUFDLEdBQUcsQ0FBQyx1QkFBdUIsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUNqRSx5QkFBVyxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsaUJBQWlCLEVBQUUsZUFBZSxDQUFDLENBQUM7UUFDMUQsSUFBSSxlQUFlLEVBQUU7WUFDakIscUJBQVMsQ0FBQyxZQUFZLENBQUMsT0FBTyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBQ3hDLHFCQUFTLENBQUMsZUFBZSxDQUFDLE9BQU8sRUFBRSxNQUFNLENBQUMsQ0FBQztTQUM5QztLQUNKO0lBQ0QsSUFBSSxhQUFLLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsRUFBRTtRQUNwQyxJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFBRTtZQUNuQix5QkFBVyxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQztTQUM1QztRQUNELG1CQUFRLENBQUMsc0JBQXNCLENBQUMsT0FBTyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0tBQ3BEO0lBRUQsTUFBTSxtQkFBUSxDQUFDLHFCQUFxQixDQUFDLE9BQU8sRUFBRSxNQUFNLENBQUMsQ0FBQztJQUN0RCxNQUFNLG1CQUFRLENBQUMsdUJBQXVCLENBQUMsT0FBTyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ3hELHlCQUFXLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxPQUFPLENBQUMsQ0FBQztBQUNuQyxDQUFDLENBQUM7QUF2QlcsUUFBQSxZQUFZLGdCQXVCdkI7QUFFSyxNQUFNLE9BQU8sR0FBc0IsS0FBSyxXQUFXLE9BQU8sRUFBRSxNQUFNO0lBQ3JFLGtCQUFrQjtBQUN0QixDQUFDLENBQUM7QUFGVyxRQUFBLE9BQU8sV0FFbEI7QUFFSyxNQUFNLFlBQVksR0FBMkIsS0FBSyxXQUFXLElBQUksRUFBRSxPQUFPO0lBQzdFLGtCQUFrQjtBQUN0QixDQUFDLENBQUM7QUFGVyxRQUFBLFlBQVksZ0JBRXZCO0FBRUssTUFBTSxXQUFXLEdBQTBCLEtBQUssV0FBVyxJQUFJLEVBQUUsT0FBTztJQUMzRSxrQkFBa0I7QUFDdEIsQ0FBQyxDQUFDO0FBRlcsUUFBQSxXQUFXLGVBRXRCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQnVpbGRIb29rLCBJQnVpbGRSZXN1bHQsIElCdWlsZFRhc2tPcHRpb24gfSBmcm9tICcuLi8uLi9AY29jb3MvY3JlYXRvci10eXBlcy9lZGl0b3IvcGFja2FnZXMvYnVpbGRlci9AdHlwZXMnO1xuaW1wb3J0IHsgQ29uZmlnIH0gZnJvbSBcIi4uL3Rvb2xzL0NvbmZpZ1wiO1xuaW1wb3J0IHsgVXRpbHMgfSBmcm9tICcuLi90b29scy9VdGlscyc7XG5pbXBvcnQgeyBCdWlsZExvZ2dlciB9IGZyb20gJy4vQnVpbGRMb2dnZXInO1xuaW1wb3J0IHsgQnVpbGRDb25maWcgfSBmcm9tICcuL3Bvc3RidWlsZC9CdWlsZENvbmZpZyc7XG5pbXBvcnQgeyBCdWlsZE5hdGl2ZSB9IGZyb20gJy4vcG9zdGJ1aWxkL0J1aWxkTmF0aXZlJztcbmltcG9ydCB7IEdhbWVUb29sIH0gZnJvbSAnLi9wb3N0YnVpbGQvR2FtZVRvb2wnO1xuaW1wb3J0IHsgSG90VXBkYXRlIH0gZnJvbSAnLi9wb3N0YnVpbGQvSG90VXBkYXRlJztcblxuY29uc3QgdGFnID0gXCJbQnVpbGRdXCI7XG5cbmV4cG9ydCBjb25zdCBvbkJlZm9yZUJ1aWxkOiBCdWlsZEhvb2sub25CZWZvcmVCdWlsZCA9IGFzeW5jIGZ1bmN0aW9uIChvcHRpb25zOiBJQnVpbGRUYXNrT3B0aW9uLCByZXN1bHQ6IElCdWlsZFJlc3VsdCkge1xuICAgIC8vIFRvZG8gc29tZSB0aGluZ1xuXG59O1xuXG5leHBvcnQgY29uc3Qgb25CZWZvcmVDb21wcmVzc1NldHRpbmdzOiBCdWlsZEhvb2sub25CZWZvcmVDb21wcmVzc1NldHRpbmdzID0gYXN5bmMgZnVuY3Rpb24gKG9wdGlvbnM6IElCdWlsZFRhc2tPcHRpb24sIHJlc3VsdDogSUJ1aWxkUmVzdWx0KSB7XG4gICAgLy8gVG9kbyBzb21lIHRoaW5nXG59O1xuXG5leHBvcnQgY29uc3Qgb25BZnRlckNvbXByZXNzU2V0dGluZ3M6IEJ1aWxkSG9vay5vbkFmdGVyQ29tcHJlc3NTZXR0aW5ncyA9IGFzeW5jIGZ1bmN0aW9uIChvcHRpb25zOiBJQnVpbGRUYXNrT3B0aW9uLCByZXN1bHQ6IElCdWlsZFJlc3VsdCkge1xuICAgIC8vIFRvZG8gc29tZSB0aGluZ1xufTtcblxuZXhwb3J0IGNvbnN0IG9uQWZ0ZXJCdWlsZDogQnVpbGRIb29rLm9uQWZ0ZXJCdWlsZCA9IGFzeW5jIGZ1bmN0aW9uIChvcHRpb25zOiBJQnVpbGRUYXNrT3B0aW9uLCByZXN1bHQ6IElCdWlsZFJlc3VsdCkge1xuICAgIEJ1aWxkTG9nZ2VyLmluZm8odGFnLCBcIuWQjuWkhOeQhuW8gOWni1wiKTtcbiAgICBCdWlsZENvbmZpZy5leGVjdXRlKG9wdGlvbnMsIHJlc3VsdCk7XG4gICAgaWYgKFV0aWxzLmlzTmF0aXZlKG9wdGlvbnMucGxhdGZvcm0pKSB7XG4gICAgICAgIEJ1aWxkTmF0aXZlLmV4ZWN1dGUob3B0aW9ucywgcmVzdWx0KTtcbiAgICAgICAgLyoqIOaYr+WQpuWQr+eUqOeDreabtCAqL1xuICAgICAgICBsZXQgaG90dXBkYXRlRW5hYmxlID0gQ29uZmlnLmdldChcImdhbWVTZXR0aW5nLmhvdHVwZGF0ZVwiLCBmYWxzZSk7XG4gICAgICAgIEJ1aWxkTG9nZ2VyLmluZm8odGFnLCAnaG90dXBkYXRlRW5hYmxlJywgaG90dXBkYXRlRW5hYmxlKTtcbiAgICAgICAgaWYgKGhvdHVwZGF0ZUVuYWJsZSkge1xuICAgICAgICAgICAgSG90VXBkYXRlLm1vZGlmeUpzRmlsZShvcHRpb25zLCByZXN1bHQpO1xuICAgICAgICAgICAgSG90VXBkYXRlLnJlcGxhY2VNYW5pZmVzdChvcHRpb25zLCByZXN1bHQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmIChVdGlscy5pc01pbmlnYW1lKG9wdGlvbnMucGxhdGZvcm0pKSB7XG4gICAgICAgIGlmICghb3B0aW9ucy5tZDVDYWNoZSkge1xuICAgICAgICAgICAgQnVpbGRMb2dnZXIuZXJyb3IodGFnLCBcIuWwj+a4uOaIj+ivt+W8gOWQr01kNUNhY2hlXCIpO1xuICAgICAgICB9XG4gICAgICAgIEdhbWVUb29sLm1pbmlnYW1lRGVsZXRlTWFuaWZlc3Qob3B0aW9ucywgcmVzdWx0KTtcbiAgICB9XG5cbiAgICBhd2FpdCBHYW1lVG9vbC5tb2RpZnlSZW1vdGVSZXNTZXJ2ZXIob3B0aW9ucywgcmVzdWx0KTtcbiAgICBhd2FpdCBHYW1lVG9vbC51cGxvYWRSZW1vdGVSZXNUb0FsaU9zcyhvcHRpb25zLCByZXN1bHQpO1xuICAgIEJ1aWxkTG9nZ2VyLmluZm8odGFnLCBcIuWQjuWkhOeQhue7k+adn1wiKTtcbn07XG5cbmV4cG9ydCBjb25zdCBvbkVycm9yOiBCdWlsZEhvb2sub25FcnJvciA9IGFzeW5jIGZ1bmN0aW9uIChvcHRpb25zLCByZXN1bHQpIHtcbiAgICAvLyBUb2RvIHNvbWUgdGhpbmdcbn07XG5cbmV4cG9ydCBjb25zdCBvbkJlZm9yZU1ha2U6IEJ1aWxkSG9vay5vbkJlZm9yZU1ha2UgPSBhc3luYyBmdW5jdGlvbiAocm9vdCwgb3B0aW9ucykge1xuICAgIC8vIFRvZG8gc29tZSB0aGluZ1xufTtcblxuZXhwb3J0IGNvbnN0IG9uQWZ0ZXJNYWtlOiBCdWlsZEhvb2sub25BZnRlck1ha2UgPSBhc3luYyBmdW5jdGlvbiAocm9vdCwgb3B0aW9ucykge1xuICAgIC8vIFRvZG8gc29tZSB0aGluZ1xufTtcblxuIl19