"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.BuildConfig = void 0;
const fs_extra_1 = __importDefault(require("fs-extra"));
const path_1 = __importDefault(require("path"));
const Constant_1 = require("../../tools/Constant");
const Utils_1 = require("../../tools/Utils");
const BuildLogger_1 = require("../BuildLogger");
/** 自定义构建配置处理 */
class BuildConfig {
    static execute(options, result) {
        let buildConfigDir = `${Utils_1.Utils.ProjectPath}/${Constant_1.Constant.BuildConfigDirName}`;
        fs_extra_1.default.ensureDirSync(buildConfigDir);
        let buildConfig = `${Utils_1.Utils.ProjectPath}/${Constant_1.Constant.BuildConfigDirName}/${options.taskName}.json`;
        if (!fs_extra_1.default.existsSync(buildConfig))
            this.createBuildConfig(buildConfig);
        let config = fs_extra_1.default.readJsonSync(buildConfig, { encoding: "utf8" });
        this.copyTemplate(options, result);
        this.insert(options, result, config.insert);
        this.replace(options, result, config.replace);
        this.replaceAsset(options, result, config.replaceAsset);
    }
    static createBuildConfig(path) {
        let obj = {
            "注释": {
                "!注意!": "下面的file字段均为与构建目录的相对路径",
                "insert": "在指定文件的指定行插入需要的代码 字段解释{file:文件名 line:第几行 content:插入内容}",
                "replace": "替换指定文件中的字符串为需要的值 字段解释{file:文件名 label:文件中被替代的文本 scriptName:从GameSetting上哪个脚本获取属性值 scriptField:脚本中的字段名字}",
                "replaceAsset": "使用assets目录中的文件替换打包后的文件 字段解释{uuid:被替换文件的uuid asset:buildConfig下assets目录中的文件名 }"
            },
            "insert": [],
            "replace": [],
            "replaceAsset": []
        };
        fs_extra_1.default.createFileSync(path);
        fs_extra_1.default.writeJsonSync(path, obj, { spaces: 4 });
    }
    /**  拷贝模板目录资源 */
    static copyTemplate(options, result) {
        let tag = "[Template]";
        let templatePath = `${Utils_1.Utils.ProjectPath}/${Constant_1.Constant.BuildConfigDirName}/${Constant_1.Constant.BuildTemplateDirName}/${options.taskName}`;
        fs_extra_1.default.ensureDirSync(templatePath);
        let buildPath = Utils_1.Utils.toUniSeparator(result.dest);
        let files = Utils_1.Utils.getAllFiles(templatePath);
        let buildDest = this.resolveBuildDest(buildPath, options.platform);
        for (const file of files) {
            let f = file.replace(templatePath, "").replace("/", "");
            let newFile = Utils_1.Utils.resolveFilePath(buildDest + "/" + f);
            fs_extra_1.default.ensureDirSync(path_1.default.dirname(newFile));
            fs_extra_1.default.copyFileSync(file, newFile);
            BuildLogger_1.BuildLogger.info(tag, "copy file", f);
        }
    }
    /** 在文件指定位置插入代码 */
    static insert(options, result, data) {
        if (!data)
            return;
        let tag = "[InsertCode]";
        let buildDest = this.resolveBuildDest(Utils_1.Utils.toUniSeparator(result.dest), options.platform);
        for (const d of data) {
            let destFile = Utils_1.Utils.resolveFilePath(buildDest + "/" + d.file);
            if (!fs_extra_1.default.existsSync(destFile)) {
                BuildLogger_1.BuildLogger.warn(tag, "文件不存在", d.file);
                continue;
            }
            let codeArr;
            if (typeof d.content === "string") {
                codeArr = d.content.split("\n");
            }
            else {
                codeArr = d.content;
            }
            let destContent = fs_extra_1.default.readFileSync(destFile, { encoding: "utf8" });
            let destArr = destContent.split("\r\n");
            if (destArr.length < 2) {
                destArr = destContent.split("\n");
            }
            destArr.splice(d.line - 1, 0, ...codeArr);
            fs_extra_1.default.writeFileSync(destFile, destArr.join("\n"));
            BuildLogger_1.BuildLogger.info(tag, d.file);
        }
    }
    /** 替换指定文件中的字符串为需要的值 */
    static replace(options, result, data) {
        if (!data)
            return;
        let tag = "[ReplaceValue]";
        let buildDest = this.resolveBuildDest(Utils_1.Utils.toUniSeparator(result.dest), options.platform);
        let mainScene = Utils_1.Utils.findFile(Utils_1.Utils.ProjectPath + "/assets", v => v.endsWith("main.scene"));
        if (!fs_extra_1.default.existsSync(mainScene)) {
            BuildLogger_1.BuildLogger.warn(tag, "main.scene文件不存在");
            return;
        }
        let objs = fs_extra_1.default.readJsonSync(mainScene, { encoding: "utf-8" });
        for (const d of data) {
            let destFile = Utils_1.Utils.resolveFilePath(buildDest + "/" + d.file);
            if (!fs_extra_1.default.existsSync(destFile)) {
                BuildLogger_1.BuildLogger.warn(tag, "文件不存在", d.file);
                continue;
            }
            let obj = objs.find(v => v['_scriptName'] == d.scriptName);
            if (obj) {
                let value = obj[d.scriptField];
                let destContent = fs_extra_1.default.readFileSync(destFile, { encoding: "utf8" });
                destContent = destContent.replace(d.label, value);
                fs_extra_1.default.writeFileSync(destFile, destContent);
                BuildLogger_1.BuildLogger.info(tag, d.file, d.label, value);
            }
            else {
                BuildLogger_1.BuildLogger.warn(tag, "对象未找到", d.scriptName);
            }
        }
    }
    /** 使用assets目录中的文件替换打包后的文件 */
    static replaceAsset(options, result, data) {
        let assetsPath = `${Utils_1.Utils.ProjectPath}/${Constant_1.Constant.BuildConfigDirName}/${Constant_1.Constant.BuildAssetsDirName}`;
        fs_extra_1.default.ensureDirSync(assetsPath);
        if (!data)
            return;
        let tag = "[ReplaceAssetValue]";
        let buildDest = this.resolveBuildDest(Utils_1.Utils.toUniSeparator(result.dest), options.platform);
        for (const d of data) {
            let oFile = `${assetsPath}/${d.asset}`;
            if (!fs_extra_1.default.existsSync(oFile)) {
                BuildLogger_1.BuildLogger.warn(tag, "源文件文件不存在", d.uuid, d.asset);
                continue;
            }
            let ext = path_1.default.extname(oFile);
            let destFile = Utils_1.Utils.getAllFiles(buildDest, file => file.includes(d.uuid) && file.endsWith(ext))[0];
            if (!fs_extra_1.default.existsSync(destFile)) {
                BuildLogger_1.BuildLogger.warn(tag, "目标文件不存在", d.uuid, d.asset);
                continue;
            }
            fs_extra_1.default.copyFileSync(oFile, destFile);
            BuildLogger_1.BuildLogger.info(tag, d.uuid, d.asset);
        }
    }
    static resolveBuildDest(buildDest, platform) {
        // if (platform == "android") {
        //     return buildDest + "/frameworks/runtime-src/proj.android-studio";
        // } else if (platform == "ios") {
        //     return buildDest + "/frameworks/runtime-src/proj.ios_mac";
        // } else if (platform == "win32") {
        //     return buildDest + "/frameworks/runtime-src/proj.win32";
        // }
        return buildDest;
    }
}
exports.BuildConfig = BuildConfig;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQnVpbGRDb25maWcuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zb3VyY2UvYnVpbGRlci9wb3N0YnVpbGQvQnVpbGRDb25maWcudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsd0RBQTBCO0FBQzFCLGdEQUF3QjtBQUV4QixtREFBZ0Q7QUFDaEQsNkNBQTBDO0FBQzFDLGdEQUE2QztBQTJCN0MsZ0JBQWdCO0FBQ2hCLE1BQWEsV0FBVztJQUViLE1BQU0sQ0FBQyxPQUFPLENBQUMsT0FBeUIsRUFBRSxNQUFvQjtRQUNqRSxJQUFJLGNBQWMsR0FBRyxHQUFHLGFBQUssQ0FBQyxXQUFXLElBQUksbUJBQVEsQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO1FBQzNFLGtCQUFFLENBQUMsYUFBYSxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQ2pDLElBQUksV0FBVyxHQUFHLEdBQUcsYUFBSyxDQUFDLFdBQVcsSUFBSSxtQkFBUSxDQUFDLGtCQUFrQixJQUFJLE9BQU8sQ0FBQyxRQUFRLE9BQU8sQ0FBQztRQUNqRyxJQUFJLENBQUMsa0JBQUUsQ0FBQyxVQUFVLENBQUMsV0FBVyxDQUFDO1lBQUUsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ3JFLElBQUksTUFBTSxHQUFHLGtCQUFFLENBQUMsWUFBWSxDQUFDLFdBQVcsRUFBRSxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsQ0FBVyxDQUFDO1FBQzFFLElBQUksQ0FBQyxZQUFZLENBQUMsT0FBTyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBQ25DLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDNUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUM5QyxJQUFJLENBQUMsWUFBWSxDQUFDLE9BQU8sRUFBRSxNQUFN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Q0FBQztnQkFDbkQsU0FBUzthQUNaO1lBQ0QsSUFBSSxHQUFHLEdBQUcsY0FBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUM5QixJQUFJLFFBQVEsR0FBRyxhQUFLLENBQUMsV0FBVyxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNwRyxJQUFJLENBQUMsa0JBQUUsQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLEVBQUU7Z0JBQzFCLHlCQUFXLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxTQUFTLEVBQUUsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQ2xELFNBQVM7YUFDWjtZQUVELGtCQUFFLENBQUMsWUFBWSxDQUFDLEtBQUssRUFBRSxRQUFRLENBQUMsQ0FBQztZQUNqQyx5QkFBVyxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUM7U0FDMUM7SUFDTCxDQUFDO0lBS08sTUFBTSxDQUFDLGdCQUFnQixDQUFDLFNBQVMsRUFBRSxRQUFRO1FBQy9DLCtCQUErQjtRQUMvQix3RUFBd0U7UUFDeEUsa0NBQWtDO1FBQ2xDLGlFQUFpRTtRQUNqRSxvQ0FBb0M7UUFDcEMsK0RBQStEO1FBQy9ELElBQUk7UUFDSixPQUFPLFNBQVMsQ0FBQztJQUNyQixDQUFDO0NBQ0o7QUFwSkQsa0NBb0pDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGZzIGZyb20gXCJmcy1leHRyYVwiO1xuaW1wb3J0IHBhdGggZnJvbSBcInBhdGhcIjtcbmltcG9ydCB7IElCdWlsZFJlc3VsdCwgSUJ1aWxkVGFza09wdGlvbiB9IGZyb20gXCIuLi8uLi8uLi9AY29jb3MvY3JlYXRvci10eXBlcy9lZGl0b3IvcGFja2FnZXMvYnVpbGRlci9AdHlwZXNcIjtcbmltcG9ydCB7IENvbnN0YW50IH0gZnJvbSBcIi4uLy4uL3Rvb2xzL0NvbnN0YW50XCI7XG5pbXBvcnQgeyBVdGlscyB9IGZyb20gXCIuLi8uLi90b29scy9VdGlsc1wiO1xuaW1wb3J0IHsgQnVpbGRMb2dnZXIgfSBmcm9tIFwiLi4vQnVpbGRMb2dnZXJcIjtcblxuXG5pbnRlcmZhY2UgSW5zZXJ0Q29kZSB7XG4gICAgZmlsZTogc3RyaW5nO1xuICAgIGxpbmU6IG51bWJlcjtcbiAgICBjb250ZW50OiBzdHJpbmcgfCBzdHJpbmdbXTtcbn1cblxuaW50ZXJmYWNlIFJlcGxhY2VWYWx1ZSB7XG4gICAgZmlsZTogc3RyaW5nO1xuICAgIGxhYmVsOiBzdHJpbmc7XG4gICAgc2NyaXB0TmFtZTogc3RyaW5nO1xuICAgIHNjcmlwdEZpZWxkOiBzdHJpbmc7XG59XG5cbmludGVyZmFjZSBSZXBsYWNlQXNzZXRWYWx1ZSB7XG4gICAgdXVpZDogc3RyaW5nO1xuICAgIGFzc2V0OiBzdHJpbmc7XG59XG5cbmludGVyZmFjZSBDb25maWcge1xuICAgIGluc2VydDogSW5zZXJ0Q29kZVtdO1xuICAgIHJlcGxhY2U6IFJlcGxhY2VWYWx1ZVtdO1xuICAgIHJlcGxhY2VBc3NldDogUmVwbGFjZUFzc2V0VmFsdWVbXTtcbn1cblxuLyoqIOiHquWumuS5ieaehOW7uumFjee9ruWkhOeQhiAqL1xuZXhwb3J0IGNsYXNzIEJ1aWxkQ29uZmlnIHtcblxuICAgIHB1YmxpYyBzdGF0aWMgZXhlY3V0ZShvcHRpb25zOiBJQnVpbGRUYXNrT3B0aW9uLCByZXN1bHQ6IElCdWlsZFJlc3VsdCkge1xuICAgICAgICBsZXQgYnVpbGRDb25maWdEaXIgPSBgJHtVdGlscy5Qcm9qZWN0UGF0aH0vJHtDb25zdGFudC5CdWlsZENvbmZpZ0Rpck5hbWV9YDtcbiAgICAgICAgZnMuZW5zdXJlRGlyU3luYyhidWlsZENvbmZpZ0Rpcik7XG4gICAgICAgIGxldCBidWlsZENvbmZpZyA9IGAke1V0aWxzLlByb2plY3RQYXRofS8ke0NvbnN0YW50LkJ1aWxkQ29uZmlnRGlyTmFtZX0vJHtvcHRpb25zLnRhc2tOYW1lfS5qc29uYDtcbiAgICAgICAgaWYgKCFmcy5leGlzdHNTeW5jKGJ1aWxkQ29uZmlnKSkgdGhpcy5jcmVhdGVCdWlsZENvbmZpZyhidWlsZENvbmZpZyk7XG4gICAgICAgIGxldCBjb25maWcgPSBmcy5yZWFkSnNvblN5bmMoYnVpbGRDb25maWcsIHsgZW5jb2Rpbmc6IFwidXRmOFwiIH0pIGFzIENvbmZpZztcbiAgICAgICAgdGhpcy5jb3B5VGVtcGxhdGUob3B0aW9ucywgcmVzdWx0KTtcbiAgICAgICAgdGhpcy5pbnNlcnQob3B0aW9ucywgcmVzdWx0LCBjb25maWcuaW5zZXJ0KTtcbiAgICAgICAgdGhpcy5yZXBsYWNlKG9wdGlvbnMsIHJlc3VsdCwgY29uZmlnLnJlcGxhY2UpO1xuICAgICAgICB0aGlzLnJlcGxhY2VBc3NldChvcHRpb25zLCByZXN1bHQsIGNvbmZpZy5yZXBsYWNlQXNzZXQpO1xuICAgIH1cblxuICAgIHByaXZhdGUgc3RhdGljIGNyZWF0ZUJ1aWxkQ29uZmlnKHBhdGg6IHN0cmluZykge1xuICAgICAgICBsZXQgb2JqID0ge1xuICAgICAgICAgICAgXCLms6jph4pcIjoge1xuICAgICAgICAgICAgICAgIFwiIeazqOaEjyFcIjogXCLkuIvpnaLnmoRmaWxl5a2X5q615Z2H5Li65LiO5p6E5bu655uu5b2V55qE55u45a+56Lev5b6EXCIsXG4gICAgICAgICAgICAgICAgXCJpbnNlcnRcIjogXCLlnKjmjIflrprmlofku7bnmoTmjIflrprooYzmj5LlhaXpnIDopoHnmoTku6PnoIEg5a2X5q616Kej6YeKe2ZpbGU65paH5Lu25ZCNIGxpbmU656ys5Yeg6KGMIGNvbnRlbnQ65o+S5YWl5YaF5a65fVwiLFxuICAgICAgICAgICAgICAgIFwicmVwbGFjZVwiOiBcIuabv+aNouaMh+WumuaWh+S7tuS4reeahOWtl+espuS4suS4uumcgOimgeeahOWAvCDlrZfmrrXop6Pph4p7ZmlsZTrmlofku7blkI0gbGFiZWw65paH5Lu25Lit6KKr5pu/5Luj55qE5paH5pysIHNjcmlwdE5hbWU65LuOR2FtZVNldHRpbmfkuIrlk6rkuKrohJrmnKzojrflj5blsZ7mgKflgLwgc2NyaXB0RmllbGQ66ISa5pys5Lit55qE5a2X5q615ZCN5a2XfVwiLFxuICAgICAgICAgICAgICAgIFwicmVwbGFjZUFzc2V0XCI6IFwi5L2/55SoYXNzZXRz55uu5b2V5Lit55qE5paH5Lu25pu/5o2i5omT5YyF5ZCO55qE5paH5Lu2IOWtl+auteino+mHint1dWlkOuiiq+abv+aNouaWh+S7tueahHV1aWQgYXNzZXQ6YnVpbGRDb25maWfkuIthc3NldHPnm67lvZXkuK3nmoTmlofku7blkI0gfVwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJpbnNlcnRcIjogW10sXG4gICAgICAgICAgICBcInJlcGxhY2VcIjogW10sXG4gICAgICAgICAgICBcInJlcGxhY2VBc3NldFwiOiBbXVxuICAgICAgICB9XG4gICAgICAgIGZzLmNyZWF0ZUZpbGVTeW5jKHBhdGgpO1xuICAgICAgICBmcy53cml0ZUpzb25TeW5jKHBhdGgsIG9iaiwgeyBzcGFjZXM6IDQgfSk7XG4gICAgfVxuXG4gICAgLyoqICDmi7fotJ3mqKHmnb/nm67lvZXotYTmupAgKi9cbiAgICBwcml2YXRlIHN0YXRpYyBjb3B5VGVtcGxhdGUob3B0aW9uczogSUJ1aWxkVGFza09wdGlvbiwgcmVzdWx0OiBJQnVpbGRSZXN1bHQpIHtcbiAgICAgICAgbGV0IHRhZyA9IFwiW1RlbXBsYXRlXVwiO1xuICAgICAgICBsZXQgdGVtcGxhdGVQYXRoID0gYCR7VXRpbHMuUHJvamVjdFBhdGh9LyR7Q29uc3RhbnQuQnVpbGRDb25maWdEaXJOYW1lfS8ke0NvbnN0YW50LkJ1aWxkVGVtcGxhdGVEaXJOYW1lfS8ke29wdGlvbnMudGFza05hbWV9YDtcbiAgICAgICAgZnMuZW5zdXJlRGlyU3luYyh0ZW1wbGF0ZVBhdGgpO1xuICAgICAgICBsZXQgYnVpbGRQYXRoID0gVXRpbHMudG9VbmlTZXBhcmF0b3IocmVzdWx0LmRlc3QpO1xuICAgICAgICBsZXQgZmlsZXMgPSBVdGlscy5nZXRBbGxGaWxlcyh0ZW1wbGF0ZVBhdGgpO1xuICAgICAgICBsZXQgYnVpbGREZXN0ID0gdGhpcy5yZXNvbHZlQnVpbGREZXN0KGJ1aWxkUGF0aCwgb3B0aW9ucy5wbGF0Zm9ybSk7XG4gICAgICAgIGZvciAoY29uc3QgZmlsZSBvZiBmaWxlcykge1xuICAgICAgICAgICAgbGV0IGYgPSBmaWxlLnJlcGxhY2UodGVtcGxhdGVQYXRoLCBcIlwiKS5yZXBsYWNlKFwiL1wiLCBcIlwiKTtcbiAgICAgICAgICAgIGxldCBuZXdGaWxlID0gVXRpbHMucmVzb2x2ZUZpbGVQYXRoKGJ1aWxkRGVzdCArIFwiL1wiICsgZik7XG4gICAgICAgICAgICBmcy5lbnN1cmVEaXJTeW5jKHBhdGguZGlybmFtZShuZXdGaWxlKSk7XG4gICAgICAgICAgICBmcy5jb3B5RmlsZVN5bmMoZmlsZSwgbmV3RmlsZSk7XG4gICAgICAgICAgICBCdWlsZExvZ2dlci5pbmZvKHRhZywgXCJjb3B5IGZpbGVcIiwgZik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKiog5Zyo5paH5Lu25oyH5a6a5L2N572u5o+S5YWl5Luj56CBICovXG4gICAgcHJpdmF0ZSBzdGF0aWMgaW5zZXJ0KG9wdGlvbnM6IElCdWlsZFRhc2tPcHRpb24sIHJlc3VsdDogSUJ1aWxkUmVzdWx0LCBkYXRhOiBJbnNlcnRDb2RlW10pIHtcbiAgICAgICAgaWYgKCFkYXRhKSByZXR1cm47XG4gICAgICAgIGxldCB0YWcgPSBcIltJbnNlcnRDb2RlXVwiO1xuICAgICAgICBsZXQgYnVpbGREZXN0ID0gdGhpcy5yZXNvbHZlQnVpbGREZXN0KFV0aWxzLnRvVW5pU2VwYXJhdG9yKHJlc3VsdC5kZXN0KSwgb3B0aW9ucy5wbGF0Zm9ybSk7XG4gICAgICAgIGZvciAoY29uc3QgZCBvZiBkYXRhKSB7XG4gICAgICAgICAgICBsZXQgZGVzdEZpbGUgPSBVdGlscy5yZXNvbHZlRmlsZVBhdGgoYnVpbGREZXN0ICsgXCIvXCIgKyBkLmZpbGUpO1xuICAgICAgICAgICAgaWYgKCFmcy5leGlzdHNTeW5jKGRlc3RGaWxlKSkge1xuICAgICAgICAgICAgICAgIEJ1aWxkTG9nZ2VyLndhcm4odGFnLCBcIuaWh+S7tuS4jeWtmOWcqFwiLCBkLmZpbGUpO1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBsZXQgY29kZUFycjogc3RyaW5nW107XG4gICAgICAgICAgICBpZiAodHlwZW9mIGQuY29udGVudCA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgICAgIGNvZGVBcnIgPSBkLmNvbnRlbnQuc3BsaXQoXCJcXG5cIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvZGVBcnIgPSBkLmNvbnRlbnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgZGVzdENvbnRlbnQgPSBmcy5yZWFkRmlsZVN5bmMoZGVzdEZpbGUsIHsgZW5jb2Rpbmc6IFwidXRmOFwiIH0pO1xuICAgICAgICAgICAgbGV0IGRlc3RBcnIgPSBkZXN0Q29udGVudC5zcGxpdChcIlxcclxcblwiKTtcbiAgICAgICAgICAgIGlmIChkZXN0QXJyLmxlbmd0aCA8IDIpIHtcbiAgICAgICAgICAgICAgICBkZXN0QXJyID0gZGVzdENvbnRlbnQuc3BsaXQoXCJcXG5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkZXN0QXJyLnNwbGljZShkLmxpbmUgLSAxLCAwLCAuLi5jb2RlQXJyKTtcbiAgICAgICAgICAgIGZzLndyaXRlRmlsZVN5bmMoZGVzdEZpbGUsIGRlc3RBcnIuam9pbihcIlxcblwiKSk7XG4gICAgICAgICAgICBCdWlsZExvZ2dlci5pbmZvKHRhZywgZC5maWxlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKiDmm7/mjaLmjIflrprmlofku7bkuK3nmoTlrZfnrKbkuLLkuLrpnIDopoHnmoTlgLwgKi9cbiAgICBwcml2YXRlIHN0YXRpYyByZXBsYWNlKG9wdGlvbnM6IElCdWlsZFRhc2tPcHRpb24sIHJlc3VsdDogSUJ1aWxkUmVzdWx0LCBkYXRhOiBSZXBsYWNlVmFsdWVbXSkge1xuICAgICAgICBpZiAoIWRhdGEpIHJldHVybjtcbiAgICAgICAgbGV0IHRhZyA9IFwiW1JlcGxhY2VWYWx1ZV1cIjtcbiAgICAgICAgbGV0IGJ1aWxkRGVzdCA9IHRoaXMucmVzb2x2ZUJ1aWxkRGVzdChVdGlscy50b1VuaVNlcGFyYXRvcihyZXN1bHQuZGVzdCksIG9wdGlvbnMucGxhdGZvcm0pO1xuICAgICAgICBsZXQgbWFpblNjZW5lID0gVXRpbHMuZmluZEZpbGUoVXRpbHMuUHJvamVjdFBhdGggKyBcIi9hc3NldHNcIiwgdiA9PiB2LmVuZHNXaXRoKFwibWFpbi5zY2VuZVwiKSk7XG5cbiAgICAgICAgaWYgKCFmcy5leGlzdHNTeW5jKG1haW5TY2VuZSkpIHtcbiAgICAgICAgICAgIEJ1aWxkTG9nZ2VyLndhcm4odGFnLCBcIm1haW4uc2NlbmXmlofku7bkuI3lrZjlnKhcIik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgbGV0IG9ianM6IGFueVtdID0gZnMucmVhZEpzb25TeW5jKG1haW5TY2VuZSwgeyBlbmNvZGluZzogXCJ1dGYtOFwiIH0pO1xuXG4gICAgICAgIGZvciAoY29uc3QgZCBvZiBkYXRhKSB7XG4gICAgICAgICAgICBsZXQgZGVzdEZpbGUgPSBVdGlscy5yZXNvbHZlRmlsZVBhdGgoYnVpbGREZXN0ICsgXCIvXCIgKyBkLmZpbGUpO1xuICAgICAgICAgICAgaWYgKCFmcy5leGlzdHNTeW5jKGRlc3RGaWxlKSkge1xuICAgICAgICAgICAgICAgIEJ1aWxkTG9nZ2VyLndhcm4odGFnLCBcIuaWh+S7tuS4jeWtmOWcqFwiLCBkLmZpbGUpO1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IG9iaiA9IG9ianMuZmluZCh2ID0+IHZbJ19zY3JpcHROYW1lJ10gPT0gZC5zY3JpcHROYW1lKTtcbiAgICAgICAgICAgIGlmIChvYmopIHtcbiAgICAgICAgICAgICAgICBsZXQgdmFsdWUgPSBvYmpbZC5zY3JpcHRGaWVsZF07XG4gICAgICAgICAgICAgICAgbGV0IGRlc3RDb250ZW50ID0gZnMucmVhZEZpbGVTeW5jKGRlc3RGaWxlLCB7IGVuY29kaW5nOiBcInV0ZjhcIiB9KTtcbiAgICAgICAgICAgICAgICBkZXN0Q29udGVudCA9IGRlc3RDb250ZW50LnJlcGxhY2UoZC5sYWJlbCwgdmFsdWUpO1xuICAgICAgICAgICAgICAgIGZzLndyaXRlRmlsZVN5bmMoZGVzdEZpbGUsIGRlc3RDb250ZW50KTtcbiAgICAgICAgICAgICAgICBCdWlsZExvZ2dlci5pbmZvKHRhZywgZC5maWxlLCBkLmxhYmVsLCB2YWx1ZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIEJ1aWxkTG9nZ2VyLndhcm4odGFnLCBcIuWvueixoeacquaJvuWIsFwiLCBkLnNjcmlwdE5hbWUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKiog5L2/55SoYXNzZXRz55uu5b2V5Lit55qE5paH5Lu25pu/5o2i5omT5YyF5ZCO55qE5paH5Lu2ICovXG4gICAgcHJpdmF0ZSBzdGF0aWMgcmVwbGFjZUFzc2V0KG9wdGlvbnM6IElCdWlsZFRhc2tPcHRpb24sIHJlc3VsdDogSUJ1aWxkUmVzdWx0LCBkYXRhOiBSZXBsYWNlQXNzZXRWYWx1ZVtdKSB7XG4gICAgICAgIGxldCBhc3NldHNQYXRoID0gYCR7VXRpbHMuUHJvamVjdFBhdGh9LyR7Q29uc3RhbnQuQnVpbGRDb25maWdEaXJOYW1lfS8ke0NvbnN0YW50LkJ1aWxkQXNzZXRzRGlyTmFtZX1gO1xuICAgICAgICBmcy5lbnN1cmVEaXJTeW5jKGFzc2V0c1BhdGgpO1xuICAgICAgICBpZiAoIWRhdGEpIHJldHVybjtcbiAgICAgICAgbGV0IHRhZyA9IFwiW1JlcGxhY2VBc3NldFZhbHVlXVwiO1xuICAgICAgICBsZXQgYnVpbGREZXN0ID0gdGhpcy5yZXNvbHZlQnVpbGREZXN0KFV0aWxzLnRvVW5pU2VwYXJhdG9yKHJlc3VsdC5kZXN0KSwgb3B0aW9ucy5wbGF0Zm9ybSk7XG5cbiAgICAgICAgZm9yIChjb25zdCBkIG9mIGRhdGEpIHtcbiAgICAgICAgICAgIGxldCBvRmlsZSA9IGAke2Fzc2V0c1BhdGh9LyR7ZC5hc3NldH1gO1xuICAgICAgICAgICAgaWYgKCFmcy5leGlzdHNTeW5jKG9GaWxlKSkge1xuICAgICAgICAgICAgICAgIEJ1aWxkTG9nZ2VyLndhcm4odGFnLCBcIua6kOaWh+S7tuaWh+S7tuS4jeWtmOWcqFwiLCBkLnV1aWQsIGQuYXNzZXQpO1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IGV4dCA9IHBhdGguZXh0bmFtZShvRmlsZSk7XG4gICAgICAgICAgICBsZXQgZGVzdEZpbGUgPSBVdGlscy5nZXRBbGxGaWxlcyhidWlsZERlc3QsIGZpbGUgPT4gZmlsZS5pbmNsdWRlcyhkLnV1aWQpICYmIGZpbGUuZW5kc1dpdGgoZXh0KSlbMF07XG4gICAgICAgICAgICBpZiAoIWZzLmV4aXN0c1N5bmMoZGVzdEZpbGUpKSB7XG4gICAgICAgICAgICAgICAgQnVpbGRMb2dnZXIud2Fybih0YWcsIFwi55uu5qCH5paH5Lu25LiN5a2Y5ZyoXCIsIGQudXVpZCwgZC5hc3NldCk7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZzLmNvcHlGaWxlU3luYyhvRmlsZSwgZGVzdEZpbGUpO1xuICAgICAgICAgICAgQnVpbGRMb2dnZXIuaW5mbyh0YWcsIGQudXVpZCwgZC5hc3NldCk7XG4gICAgICAgIH1cbiAgICB9XG5cblxuXG5cbiAgICBwcml2YXRlIHN0YXRpYyByZXNvbHZlQnVpbGREZXN0KGJ1aWxkRGVzdCwgcGxhdGZvcm0pIHtcbiAgICAgICAgLy8gaWYgKHBsYXRmb3JtID09IFwiYW5kcm9pZFwiKSB7XG4gICAgICAgIC8vICAgICByZXR1cm4gYnVpbGREZXN0ICsgXCIvZnJhbWV3b3Jrcy9ydW50aW1lLXNyYy9wcm9qLmFuZHJvaWQtc3R1ZGlvXCI7XG4gICAgICAgIC8vIH0gZWxzZSBpZiAocGxhdGZvcm0gPT0gXCJpb3NcIikge1xuICAgICAgICAvLyAgICAgcmV0dXJuIGJ1aWxkRGVzdCArIFwiL2ZyYW1ld29ya3MvcnVudGltZS1zcmMvcHJvai5pb3NfbWFjXCI7XG4gICAgICAgIC8vIH0gZWxzZSBpZiAocGxhdGZvcm0gPT0gXCJ3aW4zMlwiKSB7XG4gICAgICAgIC8vICAgICByZXR1cm4gYnVpbGREZXN0ICsgXCIvZnJhbWV3b3Jrcy9ydW50aW1lLXNyYy9wcm9qLndpbjMyXCI7XG4gICAgICAgIC8vIH1cbiAgICAgICAgcmV0dXJuIGJ1aWxkRGVzdDtcbiAgICB9XG59Il19