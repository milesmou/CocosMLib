"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.CmdExecute = void 0;
const fs_extra_1 = __importDefault(require("fs-extra"));
const path_1 = __importDefault(require("path"));
const Config_1 = require("./tools/Config");
const Logger_1 = require("./tools/Logger");
const Utils_1 = require("./tools/Utils");
class CmdExecute {
    /** 功能测试 */
    static async test(...args) {
        // console.log("test",args.join(" "));
        let v = await Editor.Dialog.info(`是否上传文件到OSS?`, {
            title: "上传远程资源",
            detail: "[上传远程资源]",
            default: 2,
            buttons: ['取消', '取消1', '确认',]
        });
        console.log(v);
    }
    /** 保存游戏配置到本地 */
    static saveGameSetting(jsonStr) {
        Config_1.Config.set("gameSetting", JSON.parse(jsonStr));
    }
    /** 导表 */
    static loadExcel() {
        let workDir = Utils_1.Utils.ProjectPath + "/excel";
        let batPath = "gen_code.bat";
        let tsDir = Utils_1.Utils.ProjectPath + "/assets/scripts/gen/table";
        fs_extra_1.default.ensureDirSync(tsDir);
        Logger_1.Logger.info(workDir);
        Utils_1.Utils.exeCMD(workDir, batPath, msg => {
            Logger_1.Logger.info(msg);
        }).then(code => {
            if (!code) {
                let bundles = Utils_1.Utils.ProjectPath + "/assets/bundles";
                let dirs = Utils_1.Utils.getAllDirs(bundles, null, true);
                dirs.push(Utils_1.Utils.ProjectPath + "/assets/resources");
                for (const dir of dirs) {
                    let tableDir = dir + "/table";
                    if (fs_extra_1.default.existsSync(tableDir)) {
                        Utils_1.Utils.refreshAsset(tableDir);
                    }
                }
                Utils_1.Utils.refreshAsset(tsDir);
            }
            else {
                Logger_1.Logger.error("导表失败");
            }
        });
    }
    /** 生成一些常量 */
    static genConst() {
        //生成Bundles.ts
        {
            let bundlesDir = Utils_1.Utils.ProjectPath + "/assets/bundles";
            let outFile = Utils_1.Utils.ProjectPath + "/assets/scripts/gen/BundleConstant.ts";
            let result = [];
            let list = fs_extra_1.default.readdirSync(bundlesDir);
            for (const name of list) {
                let path = bundlesDir + "/" + name;
                if (fs_extra_1.default.statSync(path).isDirectory()) {
                    let obj = fs_extra_1.default.readJSONSync(path + ".meta");
                    if (obj['userData'] && obj['userData']['isBundle']) {
                        result.push(name);
                    }
                }
            }
            let content = `export const BundleConstant = ${JSON.stringify(result)};`;
            fs_extra_1.default.writeFileSync(outFile, content);
            Utils_1.Utils.refreshAsset(outFile);
            Logger_1.Logger.info("生成BundleConstant.ts成功");
        }
        //生成UIConstant
        {
            let map = {};
            let outFile = Utils_1.Utils.ProjectPath + "/assets/scripts/gen/UIConstant.ts";
            let ext = ".prefab";
            let path1 = Utils_1.Utils.ProjectPath + "/assets/bundles";
            let path2 = Utils_1.Utils.ProjectPath + "/assets/resources";
            let filter = (file) => file.endsWith(ext);
            let files = Utils_1.Utils.getAllFiles(path1, filter).concat(Utils_1.Utils.getAllFiles(path2, filter));
            files.forEach(v => {
                let basename = path_1.default.basename(v);
                if (v.indexOf("/uiPrefab/") > 0) {
                    let name = basename.replace(ext, "");
                    let location = "";
                    if (v.startsWith(path1)) {
                        location = v.replace(path1 + "/", "");
                        location = location.substring(location.indexOf("/") + 1);
                    }
                    else if (v.startsWith(path2)) {
                        location = v.replace(path2 + "/", "");
                    }
                    location = location.replace(ext, "");
                    map[name] = location;
                }
            });
            let content = "export const UIConstant = {\n";
            for (const key in map) {
                content += `    ${key}: "${map[key]}",\n`;
            }
            content += "} as const;";
            fs_extra_1.default.ensureDirSync(path_1.default.dirname(outFile));
            fs_extra_1.default.writeFileSync(outFile, content);
            Utils_1.Utils.refreshAsset(outFile);
            Logger_1.Logger.info("生成UIConstant成功");
        }
    }
    static closeTexCompress() {
        Logger_1.Logger.info("关闭纹理压缩开始");
        let exts = [".jpg", ".png", ".jpeg", ".pac"];
        let filter = (file) => {
            let ext = path_1.default.extname(file);
            return exts.includes(ext);
        };
        let allFiles = Utils_1.Utils.getAllFiles(Utils_1.Utils.ProjectPath + "/assets", filter);
        for (const file of allFiles) {
            if (path_1.default.basename(file).startsWith("__"))
                continue;
            let metaFile = file + ".meta";
            let obj = fs_extra_1.default.readJSONSync(metaFile);
            let compressSettings = obj.userData.compressSettings;
            if (compressSettings && compressSettings.useCompressTexture) {
                compressSettings.useCompressTexture = false;
                fs_extra_1.default.writeJSONSync(metaFile, obj, { spaces: 2 });
                Utils_1.Utils.refreshAsset(file);
                Logger_1.Logger.info("关闭纹理压缩", file);
            }
        }
        Logger_1.Logger.info("关闭纹理压缩结束");
    }
    static setTexCompress() {
        let presetId = Editor.Clipboard.read("text");
        if (presetId.length != 22) {
            Logger_1.Logger.warn("请先拷贝一个纹理压缩配置的22位UUID到剪切板(项目设置-压缩纹理-配置压缩预设集)");
        }
        else {
            Logger_1.Logger.info("纹理压缩方案UUID:", presetId);
            let exts = [".jpg", ".png", ".jpeg", ".pac"];
            let filter = (file) => {
                let ext = path_1.default.extname(file);
                return exts.includes(ext);
            };
            let allFiles = Utils_1.Utils.getAllFiles(Utils_1.Utils.ProjectPath + "/assets", filter);
            for (const file of allFiles) {
                if (path_1.default.basename(file).startsWith("__"))
                    continue;
                let metaFile = file + ".meta";
                let obj = fs_extra_1.default.readJSONSync(metaFile);
                let compressSettings = obj.userData.compressSettings;
                if (!compressSettings || !compressSettings.useCompressTexture || compressSettings.presetId != presetId) {
                    let newCompressSettings = {
                        useCompressTexture: true,
                        presetId: presetId
                    };
                    obj.userData.compressSettings = newCompressSettings;
                    fs_extra_1.default.writeJSONSync(metaFile, obj, { spaces: 2 });
                    Utils_1.Utils.refreshAsset(file);
                    Logger_1.Logger.info(`纹理压缩设置  ${file}`);
                }
            }
            Logger_1.Logger.info("设置纹理压缩结束");
        }
    }
    //切换配置开关
    static setSwitch(key, desc) {
        let value = !Config_1.Config.get(key, false);
        Config_1.Config.set(key, value);
        console.log(`${desc || key}: ${value ? "开" : "关"}`);
    }
}
exports.CmdExecute = CmdExecute;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ21kRXhlY3V0ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NvdXJjZS9DbWRFeGVjdXRlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLHdEQUEwQjtBQUMxQixnREFBd0I7QUFDeEIsMkNBQXdDO0FBQ3hDLDJDQUF3QztBQUN4Qyx5Q0FBc0M7QUFFdEMsTUFBYSxVQUFVO0lBRW5CLFdBQVc7SUFDSixNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxHQUFHLElBQVc7UUFDbkMsc0NBQXNDO1FBQ3RDLElBQUksQ0FBQyxHQUFHLE1BQU0sTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsYUFBYSxFQUFFO1lBQzVDLEtBQUssRUFBRSxRQUFRO1lBQ2YsTUFBTSxFQUFFLFVBQVU7WUFDbEIsT0FBTyxFQUFFLENBQUM7WUFDVixPQUFPLEVBQUUsQ0FBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRTtTQUNoQyxDQUFDLENBQUE7UUFDRixPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ25CLENBQUM7SUFHRCxnQkFBZ0I7SUFDVCxNQUFNLENBQUMsZUFBZSxDQUFDLE9BQWU7UUFDekMsZUFBTSxDQUFDLEdBQUcsQ0FBQyxhQUFhLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO0lBQ25ELENBQUM7SUFFRCxTQUFTO0lBQ0YsTUFBTSxDQUFDLFNBQVM7UUFDbkIsSUFBSSxPQUFPLEdBQUcsYUFBSyxDQUFDLFdBQVcsR0FBRyxRQUFRLENBQUM7UUFDM0MsSUFBSSxPQUFPLEdBQUcsY0FBYyxDQUFDO1FBQzdCLElBQUksS0FBSyxHQUFHLGFBQUssQ0FBQyxXQUFXLEdBQUcsMkJBQTJCLENBQUM7UUFDNUQsa0JBQUUsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDeEIsZUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQTtRQUNwQixhQUFL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LGVBQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFBO1FBQ3RCLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxJQUFJLElBQUksR0FBRyxLQUFLLEtBQUssQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3hELENBQUM7Q0FHSjtBQW5MRCxnQ0FtTEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZnMgZnJvbSBcImZzLWV4dHJhXCI7XHJcbmltcG9ydCBwYXRoIGZyb20gXCJwYXRoXCI7XHJcbmltcG9ydCB7IENvbmZpZyB9IGZyb20gXCIuL3Rvb2xzL0NvbmZpZ1wiO1xyXG5pbXBvcnQgeyBMb2dnZXIgfSBmcm9tIFwiLi90b29scy9Mb2dnZXJcIjtcclxuaW1wb3J0IHsgVXRpbHMgfSBmcm9tIFwiLi90b29scy9VdGlsc1wiO1xyXG5cclxuZXhwb3J0IGNsYXNzIENtZEV4ZWN1dGUge1xyXG5cclxuICAgIC8qKiDlip/og73mtYvor5UgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgYXN5bmMgdGVzdCguLi5hcmdzOiBhbnlbXSkge1xyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwidGVzdFwiLGFyZ3Muam9pbihcIiBcIikpO1xyXG4gICAgICAgIGxldCB2ID0gYXdhaXQgRWRpdG9yLkRpYWxvZy5pbmZvKGDmmK/lkKbkuIrkvKDmlofku7bliLBPU1M/YCwge1xyXG4gICAgICAgICAgICB0aXRsZTogXCLkuIrkvKDov5znqIvotYTmupBcIixcclxuICAgICAgICAgICAgZGV0YWlsOiBcIlvkuIrkvKDov5znqIvotYTmupBdXCIsXHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IDIsXHJcbiAgICAgICAgICAgIGJ1dHRvbnM6IFsn5Y+W5raIJywgJ+WPlua2iDEnLCAn56Gu6K6kJyxdXHJcbiAgICAgICAgfSlcclxuICAgICAgICBjb25zb2xlLmxvZyh2KTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgLyoqIOS/neWtmOa4uOaIj+mFjee9ruWIsOacrOWcsCAqL1xyXG4gICAgcHVibGljIHN0YXRpYyBzYXZlR2FtZVNldHRpbmcoanNvblN0cjogc3RyaW5nKSB7XHJcbiAgICAgICAgQ29uZmlnLnNldChcImdhbWVTZXR0aW5nXCIsIEpTT04ucGFyc2UoanNvblN0cikpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiDlr7zooaggKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgbG9hZEV4Y2VsKCkge1xyXG4gICAgICAgIGxldCB3b3JrRGlyID0gVXRpbHMuUHJvamVjdFBhdGggKyBcIi9leGNlbFwiO1xyXG4gICAgICAgIGxldCBiYXRQYXRoID0gXCJnZW5fY29kZS5iYXRcIjtcclxuICAgICAgICBsZXQgdHNEaXIgPSBVdGlscy5Qcm9qZWN0UGF0aCArIFwiL2Fzc2V0cy9zY3JpcHRzL2dlbi90YWJsZVwiO1xyXG4gICAgICAgIGZzLmVuc3VyZURpclN5bmModHNEaXIpO1xyXG4gICAgICAgIExvZ2dlci5pbmZvKHdvcmtEaXIpXHJcbiAgICAgICAgVXRpbHMuZXhlQ01EKHdvcmtEaXIsIGJhdFBhdGgsXHJcbiAgICAgICAgICAgIG1zZyA9PiB7XHJcbiAgICAgICAgICAgICAgICBMb2dnZXIuaW5mbyhtc2cpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgKS50aGVuKGNvZGUgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIWNvZGUpIHtcclxuICAgICAgICAgICAgICAgIGxldCBidW5kbGVzID0gVXRpbHMuUHJvamVjdFBhdGggKyBcIi9hc3NldHMvYnVuZGxlc1wiO1xyXG4gICAgICAgICAgICAgICAgbGV0IGRpcnMgPSBVdGlscy5nZXRBbGxEaXJzKGJ1bmRsZXMsIG51bGwsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgZGlycy5wdXNoKFV0aWxzLlByb2plY3RQYXRoICsgXCIvYXNzZXRzL3Jlc291cmNlc1wiKTtcclxuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgZGlyIG9mIGRpcnMpIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgdGFibGVEaXIgPSBkaXIgKyBcIi90YWJsZVwiO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChmcy5leGlzdHNTeW5jKHRhYmxlRGlyKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBVdGlscy5yZWZyZXNoQXNzZXQodGFibGVEaXIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIFV0aWxzLnJlZnJlc2hBc3NldCh0c0Rpcik7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBMb2dnZXIuZXJyb3IoXCLlr7zooajlpLHotKVcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvKiog55Sf5oiQ5LiA5Lqb5bi46YePICovXHJcbiAgICBwdWJsaWMgc3RhdGljIGdlbkNvbnN0KCkge1xyXG4gICAgICAgIC8v55Sf5oiQQnVuZGxlcy50c1xyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgbGV0IGJ1bmRsZXNEaXIgPSBVdGlscy5Qcm9qZWN0UGF0aCArIFwiL2Fzc2V0cy9idW5kbGVzXCI7XHJcbiAgICAgICAgICAgIGxldCBvdXRGaWxlID0gVXRpbHMuUHJvamVjdFBhdGggKyBcIi9hc3NldHMvc2NyaXB0cy9nZW4vQnVuZGxlQ29uc3RhbnQudHNcIjtcclxuICAgICAgICAgICAgbGV0IHJlc3VsdDogc3RyaW5nW10gPSBbXTtcclxuXHJcbiAgICAgICAgICAgIGxldCBsaXN0ID0gZnMucmVhZGRpclN5bmMoYnVuZGxlc0Rpcik7XHJcblxyXG4gICAgICAgICAgICBmb3IgKGNvbnN0IG5hbWUgb2YgbGlzdCkge1xyXG4gICAgICAgICAgICAgICAgbGV0IHBhdGggPSBidW5kbGVzRGlyICsgXCIvXCIgKyBuYW1lO1xyXG4gICAgICAgICAgICAgICAgaWYgKGZzLnN0YXRTeW5jKHBhdGgpLmlzRGlyZWN0b3J5KCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgb2JqID0gZnMucmVhZEpTT05TeW5jKHBhdGggKyBcIi5tZXRhXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmpbJ3VzZXJEYXRhJ10gJiYgb2JqWyd1c2VyRGF0YSddWydpc0J1bmRsZSddKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKG5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgbGV0IGNvbnRlbnQgPSBgZXhwb3J0IGNvbnN0IEJ1bmRsZUNvbnN0YW50ID0gJHtKU09OLnN0cmluZ2lmeShyZXN1bHQpfTtgXHJcbiAgICAgICAgICAgIGZzLndyaXRlRmlsZVN5bmMob3V0RmlsZSwgY29udGVudCk7XHJcbiAgICAgICAgICAgIFV0aWxzLnJlZnJlc2hBc3NldChvdXRGaWxlKTtcclxuICAgICAgICAgICAgTG9nZ2VyLmluZm8oXCLnlJ/miJBCdW5kbGVDb25zdGFudC50c+aIkOWKn1wiKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8v55Sf5oiQVUlDb25zdGFudFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgbGV0IG1hcCA9IHt9O1xyXG4gICAgICAgICAgICBsZXQgb3V0RmlsZSA9IFV0aWxzLlByb2plY3RQYXRoICsgXCIvYXNzZXRzL3NjcmlwdHMvZ2VuL1VJQ29uc3RhbnQudHNcIjtcclxuICAgICAgICAgICAgbGV0IGV4dCA9IFwiLnByZWZhYlwiO1xyXG5cclxuICAgICAgICAgICAgbGV0IHBhdGgxID0gVXRpbHMuUHJvamVjdFBhdGggKyBcIi9hc3NldHMvYnVuZGxlc1wiO1xyXG4gICAgICAgICAgICBsZXQgcGF0aDIgPSBVdGlscy5Qcm9qZWN0UGF0aCArIFwiL2Fzc2V0cy9yZXNvdXJjZXNcIjtcclxuICAgICAgICAgICAgbGV0IGZpbHRlciA9IChmaWxlOiBzdHJpbmcpID0+IGZpbGUuZW5kc1dpdGgoZXh0KTtcclxuICAgICAgICAgICAgbGV0IGZpbGVzID0gVXRpbHMuZ2V0QWxsRmlsZXMocGF0aDEsIGZpbHRlcikuY29uY2F0KFV0aWxzLmdldEFsbEZpbGVzKHBhdGgyLCBmaWx0ZXIpKTtcclxuICAgICAgICAgICAgZmlsZXMuZm9yRWFjaCh2ID0+IHtcclxuICAgICAgICAgICAgICAgIGxldCBiYXNlbmFtZSA9IHBhdGguYmFzZW5hbWUodik7XHJcbiAgICAgICAgICAgICAgICBpZiAodi5pbmRleE9mKFwiL3VpUHJlZmFiL1wiKSA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgbmFtZSA9IGJhc2VuYW1lLnJlcGxhY2UoZXh0LCBcIlwiKTtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgbG9jYXRpb24gPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh2LnN0YXJ0c1dpdGgocGF0aDEpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uID0gdi5yZXBsYWNlKHBhdGgxICsgXCIvXCIsIFwiXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbiA9IGxvY2F0aW9uLnN1YnN0cmluZyhsb2NhdGlvbi5pbmRleE9mKFwiL1wiKSArIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodi5zdGFydHNXaXRoKHBhdGgyKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbiA9IHYucmVwbGFjZShwYXRoMiArIFwiL1wiLCBcIlwiKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgbG9jYXRpb24gPSBsb2NhdGlvbi5yZXBsYWNlKGV4dCwgXCJcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgbWFwW25hbWVdID0gbG9jYXRpb247XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgbGV0IGNvbnRlbnQgPSBcImV4cG9ydCBjb25zdCBVSUNvbnN0YW50ID0ge1xcblwiO1xyXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiBtYXApIHtcclxuICAgICAgICAgICAgICAgIGNvbnRlbnQgKz0gYCAgICAke2tleX06IFwiJHttYXBba2V5XX1cIixcXG5gO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnRlbnQgKz0gXCJ9IGFzIGNvbnN0O1wiO1xyXG5cclxuICAgICAgICAgICAgZnMuZW5zdXJlRGlyU3luYyhwYXRoLmRpcm5hbWUob3V0RmlsZSkpO1xyXG4gICAgICAgICAgICBmcy53cml0ZUZpbGVTeW5jKG91dEZpbGUsIGNvbnRlbnQpO1xyXG4gICAgICAgICAgICBVdGlscy5yZWZyZXNoQXNzZXQob3V0RmlsZSk7XHJcbiAgICAgICAgICAgIExvZ2dlci5pbmZvKFwi55Sf5oiQVUlDb25zdGFudOaIkOWKn1wiKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgY2xvc2VUZXhDb21wcmVzcygpIHtcclxuICAgICAgICBMb2dnZXIuaW5mbyhcIuWFs+mXree6ueeQhuWOi+e8qeW8gOWni1wiKTtcclxuICAgICAgICBsZXQgZXh0cyA9IFtcIi5qcGdcIiwgXCIucG5nXCIsIFwiLmpwZWdcIiwgXCIucGFjXCJdO1xyXG4gICAgICAgIGxldCBmaWx0ZXIgPSAoZmlsZTogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgICAgIGxldCBleHQgPSBwYXRoLmV4dG5hbWUoZmlsZSk7XHJcbiAgICAgICAgICAgIHJldHVybiBleHRzLmluY2x1ZGVzKGV4dCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBhbGxGaWxlcyA9IFV0aWxzLmdldEFsbEZpbGVzKFV0aWxzLlByb2plY3RQYXRoICsgXCIvYXNzZXRzXCIsIGZpbHRlcik7XHJcbiAgICAgICAgZm9yIChjb25zdCBmaWxlIG9mIGFsbEZpbGVzKSB7XHJcbiAgICAgICAgICAgIGlmIChwYXRoLmJhc2VuYW1lKGZpbGUpLnN0YXJ0c1dpdGgoXCJfX1wiKSkgY29udGludWU7XHJcbiAgICAgICAgICAgIGxldCBtZXRhRmlsZSA9IGZpbGUgKyBcIi5tZXRhXCI7XHJcbiAgICAgICAgICAgIGxldCBvYmogPSBmcy5yZWFkSlNPTlN5bmMobWV0YUZpbGUpO1xyXG4gICAgICAgICAgICBsZXQgY29tcHJlc3NTZXR0aW5nczogeyB1c2VDb21wcmVzc1RleHR1cmU6IGJvb2xlYW4sIHByZXNldElkOiBzdHJpbmcgfSA9IG9iai51c2VyRGF0YS5jb21wcmVzc1NldHRpbmdzO1xyXG4gICAgICAgICAgICBpZiAoY29tcHJlc3NTZXR0aW5ncyAmJiBjb21wcmVzc1NldHRpbmdzLnVzZUNvbXByZXNzVGV4dHVyZSkge1xyXG4gICAgICAgICAgICAgICAgY29tcHJlc3NTZXR0aW5ncy51c2VDb21wcmVzc1RleHR1cmUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGZzLndyaXRlSlNPTlN5bmMobWV0YUZpbGUsIG9iaiwgeyBzcGFjZXM6IDIgfSk7XHJcbiAgICAgICAgICAgICAgICBVdGlscy5yZWZyZXNoQXNzZXQoZmlsZSk7XHJcbiAgICAgICAgICAgICAgICBMb2dnZXIuaW5mbyhcIuWFs+mXree6ueeQhuWOi+e8qVwiLCBmaWxlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBMb2dnZXIuaW5mbyhcIuWFs+mXree6ueeQhuWOi+e8qee7k+adn1wiKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIHNldFRleENvbXByZXNzKCkge1xyXG4gICAgICAgIGxldCBwcmVzZXRJZDogc3RyaW5nID0gRWRpdG9yLkNsaXBib2FyZC5yZWFkKFwidGV4dFwiKSBhcyBzdHJpbmc7XHJcbiAgICAgICAgaWYgKHByZXNldElkLmxlbmd0aCAhPSAyMikge1xyXG4gICAgICAgICAgICBMb2dnZXIud2FybihcIuivt+WFiOaLt+i0neS4gOS4que6ueeQhuWOi+e8qemFjee9rueahDIy5L2NVVVJROWIsOWJquWIh+advyjpobnnm67orr7nva4t5Y6L57yp57q555CGLemFjee9ruWOi+e8qemihOiuvumbhilcIilcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBMb2dnZXIuaW5mbyhcIue6ueeQhuWOi+e8qeaWueahiFVVSUQ6XCIsIHByZXNldElkKTtcclxuICAgICAgICAgICAgbGV0IGV4dHMgPSBbXCIuanBnXCIsIFwiLnBuZ1wiLCBcIi5qcGVnXCIsIFwiLnBhY1wiXTtcclxuICAgICAgICAgICAgbGV0IGZpbHRlciA9IChmaWxlOiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgICAgICAgIGxldCBleHQgPSBwYXRoLmV4dG5hbWUoZmlsZSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXh0cy5pbmNsdWRlcyhleHQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGxldCBhbGxGaWxlcyA9IFV0aWxzLmdldEFsbEZpbGVzKFV0aWxzLlByb2plY3RQYXRoICsgXCIvYXNzZXRzXCIsIGZpbHRlcik7XHJcbiAgICAgICAgICAgIGZvciAoY29uc3QgZmlsZSBvZiBhbGxGaWxlcykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHBhdGguYmFzZW5hbWUoZmlsZSkuc3RhcnRzV2l0aChcIl9fXCIpKSBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIGxldCBtZXRhRmlsZSA9IGZpbGUgKyBcIi5tZXRhXCI7XHJcbiAgICAgICAgICAgICAgICBsZXQgb2JqID0gZnMucmVhZEpTT05TeW5jKG1ldGFGaWxlKTtcclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgY29tcHJlc3NTZXR0aW5nczogeyB1c2VDb21wcmVzc1RleHR1cmU6IGJvb2xlYW4sIHByZXNldElkOiBzdHJpbmcgfSA9IG9iai51c2VyRGF0YS5jb21wcmVzc1NldHRpbmdzO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFjb21wcmVzc1NldHRpbmdzIHx8ICFjb21wcmVzc1NldHRpbmdzLnVzZUNvbXByZXNzVGV4dHVyZSB8fCBjb21wcmVzc1NldHRpbmdzLnByZXNldElkICE9IHByZXNldElkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IG5ld0NvbXByZXNzU2V0dGluZ3M6IHsgdXNlQ29tcHJlc3NUZXh0dXJlOiBib29sZWFuLCBwcmVzZXRJZDogc3RyaW5nIH0gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZUNvbXByZXNzVGV4dHVyZTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcHJlc2V0SWQ6IHByZXNldElkXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIG9iai51c2VyRGF0YS5jb21wcmVzc1NldHRpbmdzID0gbmV3Q29tcHJlc3NTZXR0aW5ncztcclxuICAgICAgICAgICAgICAgICAgICBmcy53cml0ZUpTT05TeW5jKG1ldGFGaWxlLCBvYmosIHsgc3BhY2VzOiAyIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIFV0aWxzLnJlZnJlc2hBc3NldChmaWxlKTtcclxuICAgICAgICAgICAgICAgICAgICBMb2dnZXIuaW5mbyhg57q555CG5Y6L57yp6K6+572uICAke2ZpbGV9YCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgTG9nZ2VyLmluZm8oXCLorr7nva7nurnnkIbljovnvKnnu5PmnZ9cIik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8v5YiH5o2i6YWN572u5byA5YWzXHJcbiAgICBwdWJsaWMgc3RhdGljIHNldFN3aXRjaChrZXk6IHN0cmluZywgZGVzYzogc3RyaW5nKSB7XHJcbiAgICAgICAgbGV0IHZhbHVlID0gIUNvbmZpZy5nZXQoa2V5LCBmYWxzZSk7XHJcbiAgICAgICAgQ29uZmlnLnNldChrZXksIHZhbHVlKVxyXG4gICAgICAgIGNvbnNvbGUubG9nKGAke2Rlc2MgfHwga2V5fTogJHt2YWx1ZSA/IFwi5byAXCIgOiBcIuWFs1wifWApO1xyXG4gICAgfVxyXG5cclxuXHJcbn0iXX0=